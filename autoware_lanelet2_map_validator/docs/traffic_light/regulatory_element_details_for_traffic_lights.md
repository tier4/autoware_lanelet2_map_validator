# regulatory_element_details_for_traffic_lights

## Validator name

mapping.traffic_light.regulatory_element_details

## Feature

This validator checks whether the details in the `traffic_light` subtype regulatory elements are valid.
Required information for traffic lights is written in the [Autoware documentation](https://autowarefoundation.github.io/autoware-documentation/main/design/autoware-architecture/map/map-requirements/vector-map-requirements-overview/category_traffic_light/#vm-04-01-traffic-light-basics).
This validator checks four types of issues.

The output issue marks "linestring" or "regulatory element" as the **primitive**, and the lanelet ID is written together as **ID**.

| Issue Code                                | Message                                                                                                                          | Severity | Primitive          | Description                                                                                                                                                                           | Approach                                                                                                                                                                                                                        |
| ----------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------- | -------- | ------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| TrafficLight.RegulatoryElementDetails-001 | "Regulatory element of traffic light must have a stop line(ref_line)."                                                           | Error    | Regulatory Element | There is a `traffic_light` subtype regulatory element that has no `ref_line`s                                                                                                         | Add `ref_line` to the regulatory element that refers to the id of the stop line linestring.                                                                                                                                     |
| TrafficLight.RegulatoryElementDetails-002 | "Refers of traffic light regulatory element must have type of traffic_light."                                                    | Error    | Linestring         | There is a `traffic_light` subtype regulatory element whose `refers` is not a `traffic_light` type linestring.                                                                        | Check that the `refers` in the regulatory element is a `traffic_light` type linestring.                                                                                                                                         |
| TrafficLight.RegulatoryElementDetails-003 | "ref_line of traffic light regulatory element must have type of stop_line."                                                      | Error    | Linestring         | There is a `traffic_light` subtype regulatory element whose `ref_line` is not a `stop_line` type linestring.                                                                          | Check that the `ref_line` in the regulatory element is a `stop_line` type linestring                                                                                                                                            |
| TrafficLight.RegulatoryElementDetails-004 | "light_bulbs of traffic light regulatory element must have type of light_bulbs."                                                 | Error    | Linestring         | There is a `traffic_light` subtype regulatory element whose `light_bulbs` is not a `light_bulbs` type linestring.                                                                     | Check that the `light_bulbs` in the regulatory element is a `light_bulbs` type linestring.                                                                                                                                      |
| TrafficLight.RegulatoryElementDetails-005 | "light_bulbs linestrings must have a corresponding traffic_light_id."                                                            | Error    | Linestring         | The referring `light_bulbs` linestring doesn't have a `traffic_light_id`. This issue may occur in conjunction with TrafficLight.RegulatoryElementDetails-007.                         | Add a `traffic_light_id` attribute to the `light_bulbs` linestring. The value should be the ID of the `traffic_light` linestring paired with this `light_bulbs` linestring.                                                     |
| TrafficLight.RegulatoryElementDetails-006 | "The amount of refers and light_bulbs are not the same."                                                                         | Error    | Regulatory Element | The amount of `refers` and `light_bulbs` are not the same while they should be.                                                                                                       | Check that all expected pairs of `traffic_light` and `light_bulbs` linestrings are referred by this regulatory element.                                                                                                         |
| TrafficLight.RegulatoryElementDetails-007 | "refers and light_bulbs don't have one-to-one correspondence in this regulatory element."                                        | Error    | Regulatory Element | The `refers` and `light_bulbs` referred by a `traffic_light` regulatory element should be a group of one-to-one correspondence, while this regulatory element is not.                 | Check that all expected pairs of `traffic_light` and `light_bulbs` linestrings are referred by this regulatory element, and check that each `light_bulbs` linestring is referring to the correct `traffic_light` linestring ID. |
| TrafficLight.RegulatoryElementDetails-008 | "This traffic light regulatory element has a bounding box that exceeds the threshold, possibly containing unrelated primitives." | Warning  | Regulatory Element | The traffic light regulatory element has a bounding box that is larger than expected, which may indicate that it contains unrelated primitives or covers an unnecessarily large area. | Review the regulatory element to ensure it only contains the necessary traffic light, light bulbs, and stop line primitives. Remove any unrelated primitives or split the regulatory element if it covers too large an area.    |

## Related source codes

- regulatory_element_details_for_traffic_lights.hpp
- regulatory_element_details_for_traffic_lights.cpp
