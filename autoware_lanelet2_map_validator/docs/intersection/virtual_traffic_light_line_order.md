# virtual_traffic_light_line_order

## Validator name

mapping.intersection.virtual_traffic_light_line_order

## Feature

This validator checks whether the placement of `start_line`. `ref_line (stop_line)`. and `end_line` of a virtual traffic light are organized correctly.

The validator will output the following issues with the corresponding primitive ID.

| Issue Code                                    | Message                                                                                             | Severity | Primitive          | Description                                                                                                                                                          | Approach                                                                                                                                                                                                                                                                               |
| --------------------------------------------- | --------------------------------------------------------------------------------------------------- | -------- | ------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Intersection.VirtualTrafficLightLineOrder-001 | The start_line isn't placed on a lanelet.                                                           | Error    | Linestring         | The `start_line` should be placed on a lanelet but it isn't.                                                                                                         | Write the `start_line` on the lanelet, but it can't be on any referrer lanelet.                                                                                                                                                                                                        |
| Intersection.VirtualTrafficLightLineOrder-002 | Cannot find the end_line for referrer lanelet <ID>. The end_line should be on the referrer lanelet. | Error    | Regulatory Element | The validator will distinguish which `end_line` is allocated to which referrer lanelet of the virtual traffic light. This issue appears when it cannot find a match. | Write the `end_line` above the referrer lanelet and do not write the `end_line` that crosses over multiple referrer lanelets.                                                                                                                                                          |
| Intersection.VirtualTrafficLightLineOrder-003 | The start_line must not intersect with the referrer lanelet of the virtual traffic light.           | Error    | Linestring         | The `start_line` is found to be intersecting with some referrer lanelet which is shouldn't be.                                                                       | Write the `start_line` out of the referrer lanelet. In usual, the `start_line` is written on the previous lanelet of the referrer.                                                                                                                                                     |
| Intersection.VirtualTrafficLightLineOrder-004 | Cannot find a lanelet path from start_line to end_line.                                             | Error    | Regulatory Element | The `start_line` and `end_line` are not organized so that a path can be drawn.                                                                                       | Write the `start_line` on a lanelet that can draw a path to the referrer lanelets, and make sure that the `end_line` is on the referrer lanelet.                                                                                                                                       |
| Intersection.VirtualTrafficLightLineOrder-005 | The stop_line is not placed on the path from start_line to end_line.                                | Error    | Linestring         | The `ref_line (stop_line)` should be within the path of the `start_line` and `end_line`.                                                                             | Write the `stop_line` within the path of the `start_line` and `end_line`, and it must be placed on a lanelet that is part of the path.                                                                                                                                                 |
| Intersection.VirtualTrafficLightLineOrder-006 | The order of start line, stop line, and end line is wrong (end_line ID: <ID>).                      | Error    | Regulatory Element | Same to the message. The `end_line` ID is specified since a virtual traffic light can have multiple `end_line`s.                                                     | Check that the order of `start_line`, `stop_line` and `end_line` is correct. This issue may also appear in cases when the `stop_line` is skewed that one of the points comes earlier than the `start_line`, so write the `stop_line` to be orthogonal to the lanelet path as possible. |

## Parameters

| Parameter                | Default Value               | Description                                                                                                                                                                                                                                                                                                                                     |
| ------------------------ | --------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| validation_target_refers | [intersection_coordination] | A string array of `refers` type that should be validated by this validator. Since virtual traffic light may have different structures depending on its `refers` type, users can specify regulatory elements with its `refers` type for this validation. If the type of `refers` is not the one from this array, the validation will be skipped. |

## Related source codes

- virtual_traffic_light_line_order.cpp
- virtual_traffic_light_line_order.hpp
